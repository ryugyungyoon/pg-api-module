<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <style>
    html,body {height: 100%;}
    form {overflow: hidden;}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/sha256.js"></script>
  <script type="text/javascript" src='https://code.jquery.com/jquery-3.5.1.min.js'></script>
  <script type="text/javascript">
    $(function() {

    })
    function kgPgStart(){
      let listData = {
        'pgType': 'KG_MOBILIANS',
        'sid': '000730010001',
        'cash_code': 'CN',
        'product_name': '프론트커버',
        'trade_id': 'TEST123123',
        'logo_yn': 'N',
        'amount.total': 1000,
        'amount.tax': 0,
        'amount.tax_free': 0,
        'amount.supply_value': 0,
        'integrated_pay': 'N',
        'divide_payment': 'N',
        'divide_payment_list[0].sid': 000730010001,
        'divide_payment_list[0].price': 300,
        'divide_payment_list[1].sid': 000730010002,
        'divide_payment_list[1].price': 500,
        'divide_payment_list[2].sid': 000730010001,
        'divide_payment_list[2].price': 200,
        'site_url': 'NAV',
        'ok_url': 'NAV',
        'PGPaymentOptionsDto.ep_code': 'NAV'
      };

      cfn_ajaxRequest('/api/payment/request', 'POST', listData, 'payment-kg');
    }

    function kgPgCashStart(){
      let listData = {
          'pgType': 'KG_MOBILIANS',
          'tid': '240328144666',
          'cash_code': 'CN'
      };

      cfn_ajaxRequest('/api/payment/request/cash', 'POST', listData, 'payment-kg-cash');
    }

    function cfn_ajaxRequest(url, method, data, callbackId){
    	let callback = url.split('/').reverse()[0];
    	if(callbackId != undefined && callbackId != null) {
    		callback = callbackId;
    	}

    	$.ajax({
    		url: url,
    		type: method,
    		data: data,
    		dataType: 'json',
    		contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
    		async: true,
    		success: function(resData){
    			fn_callback(callback, resData);
    		}
    	});
    }

    //요청 결과 처리 ajax callback
  function fn_callback(callbackId, resData) {
    //결제창 정보 조회
    if(callbackId === 'payment-kg'){
      console.log(resData);
      let payUrl =  resData.data.pay_url;
      $('#kgPaymentFrame').attr('src', payUrl).show();
    }
    else if(callbackId === 'payment-kg-cash'){
      console.log('성공');
    }
  }

  function payClose() {
    $('#kgPaymentFrame').hide();
    }
  </script>
</head>
<body>
  <div>
    <a href="#" class="btn_blue" onClick="kgPgStart();">결제 요청</a>
  </div>
  <div>
    <a href="#" class="btn_blue" onClick="kgPgCashStart();">결제창 호출</a>
  </div>
  <iframe id="kgPaymentFrame" style="display: none; width: 100%; height: 600px; border: none;">
  </iframe>
</body>
</html>